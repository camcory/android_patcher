From 293a19634c6a480c3baa6c2ef0de1c834e69bbc1 Mon Sep 17 00:00:00 2001
From: Luca Stefani <luca.stefani.ge1@gmail.com>
Date: Wed, 21 Feb 2018 12:41:07 +0100
Subject: [PATCH] Revert "sepolicy: Conditionally restore support for legacy f_adb interface"

This reverts commit 32f56ee0e05d0ff727e5589f955ef4743802f892.

Change-Id: Ib8bcea77d618f7fb13f4643e4e4a301fbd02b5ad
---

diff --git a/definitions.mk b/definitions.mk
index ab577cc..1af4c14 100644
--- a/definitions.mk
+++ b/definitions.mk
@@ -13,5 +13,4 @@
 	-D target_needs_platform_text_relocations=$(TARGET_NEEDS_PLATFORM_TEXT_RELOCATIONS) \
-	-D target_uses_legacy_adb_interface=$(TARGET_USES_LEGACY_ADB_INTERFACE) \
 	$(PRIVATE_TGT_RECOVERY) \
 	-s $^ > $@
 endef
diff --git a/private/adbd.te b/private/adbd.te
index 1f417f6..47a6cbd 100644
--- a/private/adbd.te
+++ b/private/adbd.te
@@ -25,11 +25,7 @@
 # Create and use network sockets.
 net_domain(adbd)
 
-# Access /dev/android_adb or /dev/usb-ffs/adb/ep0
-ifelse(target_uses_legacy_adb_interface, `true',
-  allow adbd adb_device:chr_file rw_file_perms;
-,
-)
+# Access /dev/usb-ffs/adb/ep0
 allow adbd functionfs:dir search;
 allow adbd functionfs:file rw_file_perms;
 
diff --git a/private/compat/26.0/26.0.ignore.cil b/private/compat/26.0/26.0.ignore.cil
index dd16149..e52fd38 100644
--- a/private/compat/26.0/26.0.ignore.cil
+++ b/private/compat/26.0/26.0.ignore.cil
@@ -3,8 +3,7 @@
 ;;   previous ones.  Add here to pass checkapi tests.
 (typeattribute new_objects)
 (typeattributeset new_objects
-  ( adb_device
-    adbd_exec
+  ( adbd_exec
     broadcastradio_service
     e2fs
     e2fs_exec
diff --git a/private/file_contexts b/private/file_contexts
index cf67633..f62cf5b 100644
--- a/private/file_contexts
+++ b/private/file_contexts
@@ -65,7 +65,6 @@
 /dev/adf-interface[0-9]*\.[0-9]*	u:object_r:graphics_device:s0
 /dev/adf-overlay-engine[0-9]*\.[0-9]*	u:object_r:graphics_device:s0
 /dev/alarm		u:object_r:alarm_device:s0
-/dev/android_adb.*	u:object_r:adb_device:s0
 /dev/ashmem		u:object_r:ashmem_device:s0
 /dev/audio.*		u:object_r:audio_device:s0
 /dev/binder		u:object_r:binder_device:s0
diff --git a/public/device.te b/public/device.te
index cbfa8c3..79a5468 100644
--- a/public/device.te
+++ b/public/device.te
@@ -1,7 +1,6 @@
 # Device types
 type device, dev_type, fs_type;
 type alarm_device, dev_type, mlstrustedobject;
-type adb_device, dev_type;
 type ashmem_device, dev_type, mlstrustedobject;
 type audio_device, dev_type;
 type audio_timer_device, dev_type;
diff --git a/public/recovery.te b/public/recovery.te
index 3f277c3..fe0b20e 100644
--- a/public/recovery.te
+++ b/public/recovery.te
@@ -73,11 +73,7 @@
 
   allow recovery kernel:system syslog_read;
 
-  # Access /dev/android_adb or /dev/usb-ffs/adb/ep0
-  ifelse(target_uses_legacy_adb_interface, `true',
-    allow recovery adb_device:chr_file rw_file_perms;
-  ,
-  )
+  # Access /dev/usb-ffs/adb/ep0
   allow recovery functionfs:dir search;
   allow recovery functionfs:file rw_file_perms;
 
